# Asset Organization

Theme-aware images, build output structure, and font references.

---

### Theme-Aware Image Paths

**Light Mode** (`/public/assets/light/`):
- `hero.webp`: Hero section background
- `ceremony.webp`: Ceremony event image
- `reception.webp`: Reception event image
- `travel.webp`: Travel/accommodations section image
- `registry.webp`: Gift registry section image
- `rsvp.webp`: RSVP section image

**Dark Mode** (`/public/assets/dark/`):
- `herodark.webp`: Dark hero section background
- `ceremonydark.webp`: Dark ceremony event image
- `receptiondark.webp`: Dark reception event image
- `traveldark.webp`: Dark travel/accommodations image
- `registrydark.webp`: Dark gift registry image
- `rsvpdark.webp`: Dark RSVP section image

**Usage**:
- Views use `renderThemePicture()` helper to generate `<picture>` elements with media queries
- CSS media query: `(prefers-color-scheme: dark)`
- Fallback: Light mode image for browsers without `<picture>` support
- Format: WebP for optimal compression and quality

**Naming Convention**:
- Light mode: `{section}.webp`
- Dark mode: `{section}dark.webp`

---

### Build Output Structure

**Location**: `/public/build/` (generated, not committed)

**Files**:
- `enhance.js`: Vite-built React bundle (stable filename, no hash)
- `enhance.css`: Minified Tailwind CSS with purged unused styles
- `*-[hash].js`: Chunked JavaScript modules from code splitting (in build root)

**Build Process**:
1. `npm run prebuild`: Cleans `/public/build` directory
2. `npm run build:css`: Compiles and minifies Tailwind CSS
3. `npm run build:js`: Builds React app with Vite

**Production Optimizations**:
- Tree-shaking: Removes unused code
- Minification: Compresses JavaScript and CSS
- Code splitting: Chunks by route/component (chunks use hashed filenames)
- Entry file: Stable `enhance.js` filename (no hash on entry point)

**Dev Mode**:
- `npm run dev`: Runs `vite build --watch` (rebuilds on file changes, no HMR server)
- Concurrent processes: Vite, Tailwind CSS, and Wrangler Pages dev server
- Full rebuild on changes (not hot module replacement)

---

### Font References

**System Font Stack** (defined as `BRAND_SANS` in `src/lib/pageStyles.ts`):
```css
font-family:
  -apple-system,
  BlinkMacSystemFont,
  "Segoe UI",
  "Helvetica Neue",
  Arial,
  "Noto Sans",
  sans-serif;
```

**Rationale**:
- No external font loading (performance, privacy)
- Native system fonts for optimal rendering
- Cross-platform consistency

**Monospace Stack** (for code snippets, if needed):
```css
font-family: 
  "SF Mono", 
  Monaco, 
  "Cascadia Code", 
  "Roboto Mono", 
  Consolas, 
  "Courier New", 
  monospace;
```

**Adobe Fonts** (optional, if configured):
- CSP (see `public/_headers` and `functions/_middleware.ts`) allows Adobe Typekit domains (`https://use.typekit.net`, `https://p.typekit.net`)

---

### Static Assets

**Root Level** (`/public/`):
- `index.html`: Landing page for unauthenticated visitors
- `main.css`: Hand-written CSS for landing page
- `theme-toggle.js`: Client-side theme toggle script
- `logo.webp`: Light mode logo/emblem
- `logodark.webp`: Dark mode logo/emblem
- `favicon.ico`: Browser tab icon (ICO format for sharp rendering at all sizes)
- `robots.txt`: Search engine directives (disallows all crawlers)
- `_headers`: Cloudflare Pages header configuration

**Build Output** (`/public/build/`):
- Generated by Vite and Tailwind
- Cleaned before each build via `npm run prebuild`
- Note: Not excluded by `.gitignore` (avoid committing generated build output)

---

### Cache Strategy

**Build Output** (`/build/*` only):
- `Cache-Control: public, max-age=31536000, immutable` (1 year)
- Chunked files have hashes in filename for cache busting
- Configured in `public/_headers`

**Other Static Assets** (`/assets/*`, root files):
- No special cache headers (browser defaults apply)
- Theme images served directly from `/assets/light/` and `/assets/dark/`

**Dynamic Routes**:
- `Cache-Control: no-store` for sensitive routes
- `/event`, `/admin`, `/auth/verify`, `/rsvp`, `/stripe/*`
- `X-Robots-Tag: noindex, nofollow` to prevent search indexing

**CSP Headers**:
- Middleware injects unique nonce per request
- `Content-Security-Policy` header with nonce-based script/style allowlist
- Prevents inline script execution without nonce
